aspect Optimization {

  public void ProcedureDeclaration.removeUnusedVariables() {
    getBody().removeUnusedVariables();
  }

  public void Body.removeUnusedVariables() {
    boolean done = false;

    while (!done) {
      done = true;

      for (Variable variable : variables()) {
        if (variable.references().size() == 0) {
          done = false;
          variable.delete();
        }
      }

      getRoot().flushTreeCache();
    } 
  }

}
